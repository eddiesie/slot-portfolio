System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Reel.ts","./PayoutEvaluator.ts","./PaytableConfig.ts"],(function(e){var t,o,n,i,r,l,a,s,u,h,p,c,f,b,y,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.createForOfIteratorHelperLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){l=e.cclegacy,a=e._decorator,s=e.Node,u=e.SpriteFrame,h=e.director,p=e.tween,c=e.Vec3,f=e.Component},function(e){b=e.Reel},function(e){y=e.evaluateMiddleRowCount},function(e){m=e.PaytableConfig}],execute:function(){var g,d,v,_,C,w,R,F,P,M,z,G,S;l._RF.push({},"8674bSM/ZRDN7gu346IUhGg","GameController",void 0);var k=a.ccclass,x=a.property;e("GameController",(g=k("GameController"),d=x(s),v=x([u]),_=x({tooltip:"每條轉輪的基礎步數（越大轉越久）"}),C=x({tooltip:"向右每條多加的步數（形成依序停下）"}),w=x({type:m,tooltip:"拖入 PaytableConfig；若留空會自動掃描場景取得"}),g((P=t((F=function(e){function t(){for(var t,o=arguments.length,n=new Array(o),l=0;l<o;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,i(t,"reelsRoot",P,r(t)),i(t,"symbolFrames",M,r(t)),i(t,"baseSteps",z,r(t)),i(t,"stepOffsetPerReel",G,r(t)),i(t,"paytable",S,r(t)),t._reels=[],t._spinning=!1,t._finishCallback=void 0,t}o(t,e);var l=t.prototype;return l.onLoad=function(){this.reelsRoot?(this._reels=this.reelsRoot.children.map((function(e){return e.getComponent(b)})).filter((function(e){return!!e})),this._ensurePaytable()):console.warn("[GameController] 請指定 reelsRoot")},l._ensurePaytable=function(){if(!this.paytable){var e=h.getScene();if(e)for(var t=[e];t.length;){var o=t.pop(),i=o.getComponent(m);if(i)return void(this.paytable=i);for(var r,l=n(o.children);!(r=l()).done;){var a=r.value;t.push(a)}}}},l.spin=function(e,t,o){var n=this;if(!this._spinning){this._spinning=!0,this._finishCallback=o,this._ensurePaytable(),this.paytable||console.warn("[GameController] 未設定 PaytableConfig，將使用等機率與 0 倍率。");for(var i,r=this._generateWeightedGrid(),l=0,a=Math.max(1,this.symbolFrames.length),s=0;s<this._reels.length;s++){for(var u,h,p,c=this._reels[s],f=this.baseSteps+s*this.stepOffsetPerReel+Math.floor(3*Math.random()),b=r[s][0],m=r[s][1],g=r[s][2],d=null!=(u=this.symbolFrames[b])?u:this.symbolFrames[0],v=null!=(h=this.symbolFrames[m])?h:this.symbolFrames[0],_=null!=(p=this.symbolFrames[g])?p:this.symbolFrames[0],C=Math.max(0,f-3),w=[],R=0;R<C;R++)w.push((i=void 0,null!=(i=n.symbolFrames[Math.floor(Math.random()*a)])?i:n.symbolFrames[0]));w.push(d,v,_),c.spin(f,w,[d,v,_],(function(){if(++l===n._reels.length){var t=n.paytable?y(r,e,n.paytable):{totalWin:0,wins:[]},o=t.totalWin,i=t.wins,a=i.length?{symbol:i[0].symbol,count:i[0].count,payout:i[0].payout}:null;n._highlightMiddleRowPositions(i,(function(){n._spinning=!1,n._finishCallback&&n._finishCallback(o,null!=a?a:void 0)}))}}))}t&&t()}},l.quickStop=function(){for(var e,t=n(this._reels);!(e=t()).done;){e.value.quickStop()}},l._generateWeightedGrid=function(){for(var e=[],t=this.symbolFrames.length,o=0;o<5;o++){for(var n=[],i=0;i<3;i++)this.paytable?n.push(this.paytable.pickWeighted(t)):n.push(Math.floor(Math.random()*t));e.push(n)}return e},l._highlightMiddleRowPositions=function(e,t){if(e&&0!==e.length){for(var o,i=e[0],r=[],l=n(i.positions);!(o=l()).done;){var a=o.value,s=this._reels[a];r.push(s.getVisibleNodeAtRow(1))}if(0!==r.length)for(var u=0,h=0,f=r;h<f.length;h++){var b=f[h],y=b.scale.clone();p(b).to(.12,{scale:new c(1.15*y.x,1.15*y.y,y.z)}).to(.12,{scale:y}).to(.12,{scale:new c(1.15*y.x,1.15*y.y,y.z)}).to(.12,{scale:y}).call((function(){++u===r.length&&t()})).start()}else t()}else t()},t}(f)).prototype,"reelsRoot",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(F.prototype,"symbolFrames",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z=t(F.prototype,"baseSteps",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 22}}),G=t(F.prototype,"stepOffsetPerReel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),S=t(F.prototype,"paytable",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=F))||R));l._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Paytable.ts","./PaytableConfig.ts","./GameController.ts","./PayoutEvaluator.ts","./Reel.ts","./SymbolView.ts","./UIController.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PayoutEvaluator.ts",["cc"],(function(t){var a;return{setters:[function(t){a=t.cclegacy}],execute:function(){t("evaluateMiddleRowCount",(function(t,a,n){var u=t.length;if(0===u)return{totalWin:0,wins:[]};for(var o=new Map,e=new Map,i=0;i<u;i++){var r,l=t[i][1];o.set(l,(null!=(r=o.get(l))?r:0)+1),e.has(l)||e.set(l,[]),e.get(l).push(i)}var s=null;return o.forEach((function(t,u){var o;if(!(t<3)){var i=n.getMultiplier(u,t);if(!(i<=0)){var r={count:t,symbol:u,payout:i*a,positions:null!=(o=e.get(u))?o:[]};(!s||r.payout>s.payout)&&(s=r)}}})),s?{totalWin:s.payout,wins:[s]}:{totalWin:0,wins:[]}})),a._RF.push({},"d36619M4PhM+6ELCmi4Wj6F","PayoutEvaluator",void 0),a._RF.pop()}}}));

System.register("chunks:///_virtual/Paytable.ts",["cc"],(function(e){var r;return{setters:[function(e){r=e.cclegacy}],execute:function(){var n;e("pickWeightedSymbol",(function(e,r){for(var n="number"==typeof r?Math.min(e.length,Math.max(1,r)):e.length,t=0,a=0;a<n;a++){var l;t+=Math.max(0,null!=(l=e[a])?l:0)}if(t<=0)return 0;for(var u=Math.random()*t,o=0;o<n;o++){var i;if((u-=Math.max(0,null!=(i=e[o])?i:0))<=0)return o}return n-1})),r._RF.push({},"9510f1skC5IzJInrQxdyT3+","Paytable",void 0);var t=e("SymbolId",function(e){return e[e.Blue=0]="Blue",e[e.Green=1]="Green",e[e.Orange=2]="Orange",e[e.Purple=3]="Purple",e[e.Red=4]="Red",e[e.Lollipop=5]="Lollipop",e}({}));e("SYMBOL_WEIGHTS",[30,30,30,25,25,3]),e("MIDDLE_ROW_COUNT_MULTIPLIER_BY_SYMBOL",((n={})[t.Blue]={3:10,4:20,5:50},n[t.Green]={3:10,4:20,5:50},n[t.Orange]={3:10,4:20,5:50},n[t.Purple]={3:10,4:20,5:50},n[t.Red]={3:10,4:20,5:50},n[t.Lollipop]={3:100,4:250,5:1e3},n));r._RF.pop()}}}));

System.register("chunks:///_virtual/PaytableConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,i,n,o,l,a;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,a=t.Component}],execute:function(){var u,p,c,s,f,m,b,h,g,y,w,v,d;o._RF.push({},"39e47QzcodJf5xi9pAt7C9+","PaytableConfig",void 0);var z=l.ccclass,M=l.property;t("PaytableConfig",(u=z("PaytableConfig"),p=M({type:[String],tooltip:"符號名稱（僅顯示用，可留空）"}),c=M({type:[Number],tooltip:"各符號的出現權重（越大越常見）"}),s=M({type:[Number],tooltip:"中排出現 3 個時的倍率（逐符號）"}),f=M({type:[Number],tooltip:"中排出現 4 個時的倍率（逐符號）"}),m=M({type:[Number],tooltip:"中排出現 5 個時的倍率（逐符號）"}),u((g=e((h=function(t){function e(){for(var e,r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o))||this,i(e,"symbolNames",g,n(e)),i(e,"weights",y,n(e)),i(e,"mult3",w,n(e)),i(e,"mult4",v,n(e)),i(e,"mult5",d,n(e)),e}r(e,t);var o=e.prototype;return o.getMultiplier=function(t,e){var r=function(e){return t<e.length?Math.max(0,e[t]||0):0};return 3===e?r(this.mult3):4===e?r(this.mult4):5===e?r(this.mult5):0},o.pickWeighted=function(t){for(var e=Math.min(t,this.weights.length),r=0,i=0;i<e;i++)r+=Math.max(0,this.weights[i]||0);if(r<=0)return 0;for(var n=Math.random()*r,o=0;o<e;o++)if((n-=Math.max(0,this.weights[o]||0))<=0)return o;return e-1},e}(a)).prototype,"symbolNames",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["blue","green","orange","purple","red","lollipop"]}}),y=e(h.prototype,"weights",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[30,30,30,25,25,3]}}),w=e(h.prototype,"mult3",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[10,10,10,10,10,100]}}),v=e(h.prototype,"mult4",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[20,20,20,20,20,250]}}),d=e(h.prototype,"mult5",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[50,50,50,50,50,1e3]}}),b=h))||b));o._RF.pop()}}}));

System.register("chunks:///_virtual/Reel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SymbolView.ts"],(function(t){var e,i,s,n,o,l,r,h,p,a,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.createForOfIteratorHelperLoose,n=t.createClass,o=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){r=t.cclegacy,h=t._decorator,p=t.tween,a=t.Vec3,c=t.Component},function(t){u=t.SymbolView}],execute:function(){var _,f,d,y,g,v,m;r._RF.push({},"55b3a20fBdIQo21vq2uPrXL","Reel",void 0);var b=h.ccclass,S=h.property;t("Reel",(_=b("Reel"),f=S({tooltip:"每格高度（需與三格之間的 Y 間距一致）"}),d=S({tooltip:"每一步往下滾的時間（秒）"}),_((v=e((g=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return e=t.call.apply(t,[this].concat(s))||this,o(e,"symbolHeight",v,l(e)),o(e,"stepDuration",m,l(e)),e._cells=[],e._stepsLeft=0,e._isSpinning=!1,e._onStop=void 0,e._feed=[],e._resultTop=void 0,e._resultMid=void 0,e._resultBot=void 0,e}i(e,t);var r=e.prototype;return r.onLoad=function(){var t=this.node.getChildByName("CellTop"),e=this.node.getChildByName("CellMid"),i=this.node.getChildByName("CellBot");this._cells=t&&e&&i?[t,e,i]:[].concat(this.node.children)},r.getVisibleNodeAtRow=function(t){return[].concat(this._cells).sort((function(t,e){return e.position.y-t.position.y}))[t]},r.spin=function(t,e,i,s){this._isSpinning||(this._isSpinning=!0,this._stepsLeft=Math.max(3,t),this._feed=e.slice(),this._resultTop=i[0],this._resultMid=i[1],this._resultBot=i[2],this._onStop=s,this._step())},r.quickStop=function(){if(this._isSpinning){var t=Math.min(this._stepsLeft,3);if(this._stepsLeft=t,!(t<=0)&&this._resultTop&&this._resultMid&&this._resultBot){var e=[this._resultTop,this._resultMid,this._resultBot];this._feed=e.slice(3-t)}}},r._step=function(){var t,e,i=this;if(this._stepsLeft<=0){this._isSpinning=!1;var n=this.node.position.clone();p(this.node).to(.05,{position:new a(n.x,n.y-10,n.z)}).to(.05,{position:new a(n.x,n.y,n.z)}).call((function(){return i._onStop&&i._onStop()})).start()}else{this._stepsLeft--;for(var o=0,l=1;l<this._cells.length;l++)this._cells[l].position.y<this._cells[o].position.y&&(o=l);var r=this._cells[o],h=Math.max.apply(Math,this._cells.map((function(t){return t.position.y})));r.setPosition(new a(0,h+this.symbolHeight,0));var c=this._feed.length>0?this._feed.shift():null!=(t=this._feed[this._feed.length-1])?t:null;c&&(null==(e=r.getComponent(u))||e.setSymbol(c));for(var _,f=0,d=s(this._cells);!(_=d()).done;){var y=_.value,g=y.position.clone(),v=new a(g.x,g.y-this.symbolHeight,g.z);p(y).to(this.stepDuration,{position:v}).call((function(){++f===i._cells.length&&i._step()})).start()}}},n(e,[{key:"isSpinning",get:function(){return this._isSpinning}}]),e}(c)).prototype,"symbolHeight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 160}}),m=e(g.prototype,"stepDuration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.06}}),y=g))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/SymbolView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,o,n,c,s,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){n=e.cclegacy,c=e._decorator,s=e.Sprite,l=e.Component}],execute:function(){var p,a,u,y,f;n._RF.push({},"740c4oTgcZNmKvWZp53JqEI","SymbolView",void 0);var m=c.ccclass,b=c.property;e("SymbolView",(p=m("SymbolView"),a=b(s),p((f=t((y=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),c=0;c<r;c++)n[c]=arguments[c];return t=e.call.apply(e,[this].concat(n))||this,i(t,"sprite",f,o(t)),t}return r(t,e),t.prototype.setSymbol=function(e){this.sprite&&(this.sprite.spriteFrame=e)},t}(l)).prototype,"sprite",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=y))||u));n._RF.pop()}}}));

System.register("chunks:///_virtual/UIController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts"],(function(t){var n,i,e,a,o,r,s,l,u,b,h,c,p;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,s=t.Label,l=t.Button,u=t.Node,b=t.UIOpacity,h=t.tween,c=t.Component},function(t){p=t.GameController}],execute:function(){var f,d,g,w,m,y,B,L,v,E,P,C,z,I,T,U,M,S,x,N,A,D,F,W,_,O,k,q,G;o._RF.push({},"f020cxINtFAfbyQq+JCFrlK","UIController",void 0);var R=r.ccclass,j=r.property;t("UIController",(f=R("UIController"),d=j(s),g=j(s),w=j(s),m=j(l),y=j(l),B=j(l),L=j(l),v=j(l),E=j(l),P=j(p),C=j(u),z=j(s),I=j({tooltip:"Auto 模式每局間隔秒數"}),f((M=n((U=function(t){function n(){for(var n,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return n=t.call.apply(t,[this].concat(o))||this,e(n,"balanceLabel",M,a(n)),e(n,"betLabel",S,a(n)),e(n,"winLabel",x,a(n)),e(n,"spinButton",N,a(n)),e(n,"stopButton",A,a(n)),e(n,"betMinus",D,a(n)),e(n,"betPlus",F,a(n)),e(n,"maxBet",W,a(n)),e(n,"autoBtn",_,a(n)),e(n,"game",O,a(n)),e(n,"winToastNode",k,a(n)),e(n,"winToastLabel",q,a(n)),n.balance=1e3,n.betPerLine=1,n.linesCount=10,n.lastWin=0,n.spinning=!1,n.autoEnabled=!1,e(n,"autoDelaySec",G,a(n)),n}i(n,t);var o=n.prototype;return o.start=function(){this.refreshUI(),this.updateButtons()},o.onBetPlus=function(){this.spinning||this.autoEnabled||(this.betPerLine=Math.min(this.betPerLine+1,10),this.refreshUI())},o.onBetMinus=function(){this.spinning||this.autoEnabled||(this.betPerLine=Math.max(this.betPerLine-1,1),this.refreshUI())},o.onMaxBet=function(){this.spinning||this.autoEnabled||(this.betPerLine=10,this.refreshUI())},o.onSpin=function(){var t,n=this;if(!this.spinning){var i=this.betPerLine*this.linesCount;if(this.balance<i)return console.warn("餘額不足，無法旋轉"),void(this.autoEnabled&&(this.autoEnabled=!1,this.updateButtons()));this.balance-=i,this.lastWin=0,this.spinning=!0,this.refreshUI(),this.updateButtons(),null==(t=this.game)||t.spin(this.betPerLine,(function(){}),(function(t,i){return n.roundFinished(t,i)}))}},o.onStop=function(){var t;(this.spinning||this.autoEnabled)&&(this.autoEnabled=!1,null==(t=this.game)||t.quickStop(),this.updateButtons())},o.onAuto=function(){this.autoEnabled=!this.autoEnabled,this.updateButtons(),this.autoEnabled&&!this.spinning&&this.onSpin()},o.roundFinished=function(t,n){var i=this;if(this.lastWin=t,this.balance+=t,this.spinning=!1,this.refreshUI(),this.updateButtons(),t>0){var e=n?"中獎！符號 #"+n.symbol+" ×"+n.count+" → +"+n.payout:"中獎！+"+t;this.showWinToast(e)}if(this.autoEnabled){var a=this.betPerLine*this.linesCount;this.balance>=a?this.scheduleOnce((function(){i.autoEnabled&&!i.spinning&&i.onSpin()}),this.autoDelaySec):(console.warn("Auto 已停止：餘額不足"),this.autoEnabled=!1,this.updateButtons())}},o.showWinToast=function(t){if(this.winToastNode&&this.winToastLabel){this.winToastLabel.string=t;var n=this.winToastNode.getComponent(b)||this.winToastNode.addComponent(b);h(n).to(.15,{opacity:255}).delay(1.2).to(.25,{opacity:0}).start()}},o.refreshUI=function(){this.balanceLabel&&(this.balanceLabel.string="餘額："+this.balance),this.betLabel&&(this.betLabel.string="押注："+this.betPerLine*this.linesCount),this.winLabel&&(this.winLabel.string="贏分："+this.lastWin)},o.updateButtons=function(){var t=!this.spinning&&!this.autoEnabled,n=this.spinning||this.autoEnabled;this.spinButton&&(this.spinButton.interactable=t),this.stopButton&&(this.stopButton.interactable=n);var i=this.spinning||this.autoEnabled;if(this.betMinus&&(this.betMinus.interactable=!i),this.betPlus&&(this.betPlus.interactable=!i),this.maxBet&&(this.maxBet.interactable=!i),this.autoBtn){this.autoBtn.interactable=!0;var e=this.autoBtn.getComponentInChildren(s);e&&(e.string=this.autoEnabled?"Auto: ON":"Auto")}},n}(c)).prototype,"balanceLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(U.prototype,"betLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(U.prototype,"winLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(U.prototype,"spinButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(U.prototype,"stopButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(U.prototype,"betMinus",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(U.prototype,"betPlus",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=n(U.prototype,"maxBet",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(U.prototype,"autoBtn",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(U.prototype,"game",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=n(U.prototype,"winToastNode",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(U.prototype,"winToastLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=n(U.prototype,"autoDelaySec",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),T=U))||T));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});